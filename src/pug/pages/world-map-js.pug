script(type="text/javascript").
    axios.get('https://corona-api.com/countries').then(response => {
        paintMap(response.data);
        window.onload = function() {
            worldDatatable(response.data);
        };
    })
    function paintMap(data){
        var mymap = L.map('covidWorldMap').setView([ 20, 0 ], 2);
        let mapboxAccessToken =
            'pk.eyJ1Ijoic3dhcG5pbDciLCJhIjoiY2s5ZnRtZXh1MGVuYTNkbGNhNWtrcmt0diJ9.fzy5HcciZYupAiuzpVmlWA';
        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=' + mapboxAccessToken, {
            id: 'mapbox/dark-v10',
            attribution:
                'Map data <a target="_blank" href="https://about-corona.net/">about-corona</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            minZoom: 0,
            noWrap: true,
            bounds: [ [ -90, -180 ], [ 90, 180 ] ]
        }).addTo(mymap);
        var myRenderer = L.canvas({ padding: 0.5 });
            var width = document.documentElement.clientWidth;
            if (width < 768) {
                mymap.setZoom(1);
            }
            mymap.touchZoom.disable();
            mymap.scrollWheelZoom.disable();
        function htmlPopup(region, regionCode, confirmed, recovered, deaths) {
            let output = '';
            if (regionCode !== null) {
                output += `<img src="https://www.countryflags.io/${regionCode.toLocaleLowerCase()}/shiny/16.png" style="vertical-align:middle!important; margin-right:2px;"/>`;
            }
            if (region !== null) {
                output += `<b>${region}</b>`;
            } else {
                output += `<b>${regionCode}</b>`;
            }
            if (confirmed !== null) {
                output += `<br/>Confirmed: ${confirmed.toLocaleString()}`;
            }
            if (recovered !== null) {
                output += `<br/>Recovered: ${recovered.toLocaleString()}`;
            }
            if (deaths !== null) {
                output += `<br/>Deaths: ${deaths.toLocaleString()}`;
            }
            return output;
        }
        data.data.forEach(function(country) {
            var latlng = L.latLng({ lat: country.coordinates.latitude, lng: country.coordinates.longitude });
            var circle = L.circleMarker(latlng, {
                fillOpacity: 0.5,
                radius: Math.sqrt(country.latest_data.confirmed) * 0.02,
                stroke: false,
                fillColor: '#d11a1a',
                renderer: myRenderer
            })
                .addTo(mymap)
                .bindTooltip(
                    htmlPopup(country.name, country.code, country.latest_data.confirmed, country.latest_data.recovered, country.latest_data.deaths)
                );

            let ddChartCountriesSelect = document.getElementById('ddChartCountries');
            let regionNewsSelect = document.getElementById('selectNewsRegion');
            ddChartCountriesSelect.options[ddChartCountriesSelect.options.length] = new Option(
                country.name,
                country.code
            );
            regionNewsSelect.options[regionNewsSelect.options.length] = new Option(
                country.name,
                country.code
            );
        });
        var info = L.control({ position: 'bottomright' });
    }


