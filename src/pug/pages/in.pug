extends ../layouts/dashboard.pug

block config
    - var bodyClass = 'nav-fixed'
    - var pageTitle = 'COVID-19 INDIA Dashboard'
    - var topnavStyle = 'navbar-light bg-white'
    - var pageHeaderStyle = 'page-header-dark'
    - var pageHeaderBackground = 'bg-gradient-primary-to-secondary'
    - var footerStyle = 'footer-dark bg-dark'
    - var topNavRegionTitle = 'COVID-19'
    - var topNavRegionSubTitle = 'India Dashboard'
    - var metaTitle = 'The COVID-19 USA Dashboard'
    - var metaDescription = 'As the virus that causes COVID-19 spreads worldwide, this dashboard seeks to offer a one-stop snapshot of confirmed cases globally, with country specific data, news and advisories.'
    
append css
    //- include in-map-js.pug
    script(type="text/javascript").
        function acronymToLatLong(acronym) {
            let states = {
                AN: {
                    lat: 11.66702557,
                    long: 92.73598262
                },
                AP: {
                    lat: 14.7504291,
                    long: 78.57002559
                },
                AR: {
                    lat: 27.10039878,
                    long: 93.61660071
                },
                AS: {
                    lat: 26.7499809,
                    long: 94.21666744
                },
                BR: {
                    lat: 25.78541445,
                    long: 87.4799727
                },
                CH: {
                    lat: 30.71999697,
                    long: 76.78000565
                },
                CT: {
                    lat: 22.09042035,
                    long: 82.15998734
                },
                DD: {
                    lat: 20.4283,
                    long: 72.8397
                },
                DN: {
                    lat: 20.26657819,
                    long: 73.0166178
                },
                DL: {
                    lat: 28.6699929,
                    long: 77.23000403
                },
                GA: {
                    lat: 15.491997,
                    long: 73.81800065
                },
                GJ: {
                    lat: 22.309425,
                    long: 72.13623
                },
                HR: {
                    lat: 29.065773,
                    long: 76.040497
                },
                HP: {
                    lat: 31.10002545,
                    long: 77.16659704
                },
                JK: {
                    lat: 34.29995933,
                    long: 74.46665849
                },
                JH: {
                    lat: 23.80039349,
                    long: 86.41998572
                },
                KA: {
                    lat: 12.57038129,
                    long: 76.91999711
                },
                KL: {
                    lat: 8.900372741,
                    long: 76.56999263
                },
                LA: {
                    lat: 34.209515,
                    long: 77.615112
                },
                LD: {
                    lat: 10.56257331,
                    long: 72.63686717
                },
                MP: {
                    lat: 21.30039105,
                    long: 76.13001949
                },
                MH: {
                    lat: 19.25023195,
                    long: 73.16017493
                },

                MN: {
                    lat: 24.79997072,
                    long: 93.95001705
                },
                ML: {
                    lat: 25.57049217,
                    long: 91.8800142
                },
                MZ: {
                    lat: 23.71039899,
                    long: 92.72001461
                },
                NL: {
                    lat: 25.6669979,
                    long: 94.11657019
                },
                OR: {
                    lat: 19.82042971,
                    long: 85.90001746
                },
                PY: {
                    lat: 11.93499371,
                    long: 79.83000037
                },
                PB: {
                    lat: 31.51997398,
                    long: 75.98000281
                },
                RJ: {
                    lat: 26.44999921,
                    long: 74.63998124
                },
                SK: {
                    lat: 27.3333303,
                    long: 88.6166475
                },
                TN: {
                    lat: 12.92038576,
                    long: 79.15004187
                },
                TG: {
                    lat: 17.123184,
                    long: 79.208824
                },
                TR: {
                    lat: 23.83540428,
                    long: 91.27999914
                },

                UT: {
                    lat: 29.423,
                    long: 79.4275
                },
                UP: {
                    lat: 27.59998069,
                    long: 78.05000565
                },
                Uttaranchal: {
                    lat: 30.32040895,
                    long: 78.05000565
                },
                WB: {
                    lat: 22.58039044,
                    long: 88.32994665
                }
            };

            if (states[acronym] != null) {
                return states[acronym];
            }
            return acronym;
        }
        axios.get('https://api.covid19india.org/data.json').then(response => {
            var mymap = L.map('covidCountryMap').setView([ 20.59, 78.96 ], 5);
            let mapboxAccessToken =
                'pk.eyJ1Ijoic3dhcG5pbDciLCJhIjoiY2s5ZnRtZXh1MGVuYTNkbGNhNWtrcmt0diJ9.fzy5HcciZYupAiuzpVmlWA';
            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/256/{z}/{x}/{y}?access_token=' + mapboxAccessToken, {
                id: 'mapbox/dark-v10',
                attribution:
                    'Map data <a target="_blank" href="https://api.covid19india.org/">COVID-19-India API</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
                minZoom: 4,
                maxZoom: 7,
                noWrap: true,
                bounds: [ [ -90, -180 ], [ 90, 180 ] ]
            }).addTo(mymap);
            var myRenderer = L.canvas({ padding: 0.5 });
            var width = document.documentElement.clientWidth;
            if (width < 768) {
                mymap.setZoom(4);
            }
            mymap.scrollWheelZoom.disable();
            function htmlPopup(county, confirmed, active, recovered, deaths) {
                let output = '';
                if (county !== null) {
                    output += `<b>${county}</b>, `;
                }
                if (confirmed !== null) {
                    output += `<br/>Confirmed: ${parseInt(confirmed).toLocaleString()}`;
                }
                if (active !== null) {
                    output += `<br/>Active: ${parseInt(active).toLocaleString()}`;
                }
                if (recovered !== null) {
                    output += `<br/>Recovered: ${parseInt(recovered).toLocaleString()}`;
                }
                if (deaths !== null) {
                    output += `<br/>Deaths: ${parseInt(deaths).toLocaleString()}`;
                }
                return output;
            }

            let filteredArr = response.data.statewise.filter(function(states) {
                return states.statecode !== 'TT' && states.statecode !== 'UN';
            });
            filteredArr.forEach(function(state) {
                var latlng = L.latLng({
                    lat: acronymToLatLong(state.statecode).lat,
                    lng: acronymToLatLong(state.statecode).long
                });
                var circle = L.circleMarker(latlng, {
                    fillOpacity: 0.3,
                    radius: Math.sqrt(parseInt(state.confirmed)) * 0.2,
                    stroke: false,
                    fillColor: '#0061F2',
                    renderer: myRenderer
                })
                    .addTo(mymap)
                    .bindTooltip(htmlPopup(state.state, state.confirmed, state.active, state.recovered, state.deaths));
                //- let initialRadius = circle.options.radius
                //- mymap.on('zoomend', function() {
                //-     var currentZoom = mymap.getZoom();
                //-     if(currentZoom > 3){
                //-         circle.setStyle({radius: initialRadius*currentZoom});
                //-     }else{
                //-         circle.setStyle({radius:initialRadius});
                //-     }
                //- });
            });
            var info = L.control({ position: 'bottomright' });
        })
        .catch((error) => {
            if (error.response) {
                console.log(
                    'The request was made and the server responded with a status code that falls out of the range of 2xx'
                );
                console.log('Error Data: ', error.response.data);
                console.log('Error Status: ', error.response.status);
                console.log('Error Headers: ', error.response.headers);
            } else if (error.request) {
                console.log(
                    'The request was made but no response was received. `error.request` is an instance of XMLHttpRequest in the browser and an instance of http.ClientRequest in node.js'
                );
                console.log('Error Request: ', error.request);
            } else {
                console.log('Something happened in setting up the request that triggered an Error');
                console.log('Error Message: ', error.message);
            }
            console.log('Error config: ', error.config);
        });

    link(href='css/styles.min.css', rel='stylesheet')
    link(href='https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css', rel='stylesheet', crossorigin='anonymous')
block content
    .container-fluid.mt-4
        .card.mb-4
            .card-header.bg-dark.d-block
                h3.text-white.mb-0 Cases in India
                p.text-white.text-muted.mb-0.pt-1 Tap/hover on the marker for more information
            .card-body.p-3
                #covidCountryMap(style="height:60vh")
                #last-updated.text-center.pt-3.pb-1
                .row.justify-content-center.p-0.pt-2
                    .card-stats.col-md-3
                        .card.h-100.bg-dark.border-0
                            .card-body
                                h3.text-white-75.mb-3.d-inline-block Confirmed
                                img.text-white-50.float-right(src="../../assets/img/icons/icon_confirmed.svg", onerror="this.onerror=null;")
                                #number-confirmed.text-white.mb-0
                                .d-flex.justify-content-start.align-items-center
                                    #today-confirmed.text-white-75 Loading stat...
                                    span &nbsp;
                                    #per-confirmed.text-white-75.small
                    .card-stats.col-md-3
                        .card.h-100.bg-secondary.border-0
                            .card-body
                                h3.text-white-75.mb-3.d-inline-block Active
                                img.text-white-50.float-right(src="../../assets/img/icons/icon_active.svg", onerror="this.onerror=null;")
                                #number-active.text-white.mb-0
                                #per-active.text-white-75 Loading stat...
                    .card-stats.col-md-3
                        .card.h-100.bg-success.border-0
                            .card-body
                                h3.text-white-75.mb-3.d-inline-block Recovered
                                img.text-white-50.float-right(src="../../assets/img/icons/icon_recovered.svg", onerror="this.onerror=null;")
                                #number-recovered.text-white.mb-0
                                .d-flex.justify-content-between
                                    #today-recovered.text-white-75 Loading stat...
                                    #per-recovered.text-white-75.small 
                    .card-stats.col-md-3
                        .card.h-100.bg-danger.border-0
                            .card-body
                                h3.text-white-75.mb-3.d-inline-block Deaths
                                img.text-white-50.float-right(src="../../assets/img/icons/icon_death.svg", onerror="this.onerror=null;")
                                #number-deaths.text-white.mb-0 
                                .d-flex.justify-content-start.align-items-center
                                    #today-deaths.text-white-75 Loading stat...
                                    span &nbsp;
                                    #per-deaths.text-white-75.small
                    .col-sm-12.p-0
                        p.small.pt-2.pr-2.mb-0.text-right
                            em Data derived from&nbsp;
                                a.w-100.pt-2(href="https://api.covid19india.org" target="_blank") COVID19-India API
                                    i.icon-new-tab.ml-1
        .row
            .col-sm-12
                .card.pb-2.mb-4
                    .card-header.bg-dark.d-block
                        h3.text-white.mb-0  Daily Trend of Cases
                        p.text-white.text-muted.mb-0.pt-1 Filter by Region, Type & Scale
                    .card-body(style="background-color: #191a1a !important;")
                        .row
                            .col-sm-12.col-md-9.p-0
                                canvas#myChart.p-1.tuatara(style="width:100%; height:30rem")
                            .col-sm-12.col-md-3.pl-md-4
                                .row.d-flex.justify-content-center.pt-2.text-white
                                    #total-date
                                .row.d-flex.justify-content-around.pb-4.pt-1.text-center.text-white.border-bottom
                                    .col.p-1
                                        p.mb-1
                                            small.font-weight-light.mb-1 Confirmed
                                        p#total-confirmed.card-text.text-dark loading...
                                    .col.p-1
                                        p.mb-1
                                            small.font-weight-light.mb-1 Recovered
                                        p#total-recovered.card-text.text-dark loading...
                                    .col.p-1
                                        p.mb-1
                                            small.font-weight-light.mb-1 Deaths
                                        p#total-deaths.card-text.text-dark loading... 
                                .d-flex.justify-content-between
                                    .col.mt-2
                                        p.font-italic.font-weight-300.text-left.mt-4.mb-2 Period
                                        .custom-control.custom-radio.custom-control-solid.text-white
                                            input#sinceBeginning.custom-control-input(type='radio', name='timeframe', value="beginning")
                                            label.custom-control-label.font-weight-300(for='sinceBeginning') From the Beginning
                                        .custom-control.custom-radio.custom-control-solid.text-white
                                            input#sinceMonth.custom-control-input(type='radio', name='timeframe' ,value="month", checked)
                                            label.custom-control-label.font-weight-300(for='sinceMonth') Recent Month
                                        .custom-control.custom-radio.custom-control-solid.text-white
                                            input#sinceWeeks.custom-control-input(type='radio', name='timeframe', value="weeks")
                                            label.custom-control-label.font-weight-300(for='sinceWeeks') Recent 2 Weeks
                                    .col.mt-2
                                        p.font-italic.font-weight-300.text-left.mt-4.mb-2 Case Type
                                        .custom-control.custom-radio.custom-control-solid.text-white
                                            input#confirmedRadio.custom-control-input(type='radio', name='caseTypeRadio', value="confirmed" checked)
                                            label.custom-control-label.font-weight-300(for='confirmedRadio') Confirmed 
                                        .custom-control.custom-radio.custom-control-solid.text-white
                                            input#recoveredRadio.custom-control-input(type='radio', name='caseTypeRadio', value="recovered")
                                            label.custom-control-label.font-weight-300(for='recoveredRadio') Recovered
                                        .custom-control.custom-radio.custom-control-solid.text-white
                                            input#deathsRadio.custom-control-input(type='radio', name='caseTypeRadio', value="deaths")
                                            label.custom-control-label.font-weight-300(for='deathsRadio') Deaths
                                .d-flex.justify-content-between
                                    .col.mt-2
                                        p.font-italic.font-weight-300.text-left.mt-4.mb-2 Chart Type
                                        .custom-control.custom-radio.custom-control-solid.text-white
                                            input#barRadio.custom-control-input(type='radio', name='chartTypeRadio' value="bar", checked)
                                            label.custom-control-label.font-weight-300(for='barRadio') Bar 
                                        .custom-control.custom-radio.custom-control-solid.text-white
                                            input#lineRadio.custom-control-input(type='radio', name='chartTypeRadio', value="line")
                                            label.custom-control-label.font-weight-300(for='lineRadio') Line
                                    .col.mt-2
                                        p.font-italic.font-weight-300.text-left.mt-4.mb-2 Scale
                                        .custom-control.custom-radio.custom-control-solid.text-white
                                            input#linearRadio.custom-control-input(type='radio', name='scaleTypeRadio', value="linear" checked)
                                            label.custom-control-label.font-weight-300(for='linearRadio') Linear 
                                        .custom-control.custom-radio.custom-control-solid.text-white
                                            input#logarithmicRadio.custom-control-input(type='radio', name='scaleTypeRadio',value="logarithmic" )
                                            label.custom-control-label.font-weight-300(for='logarithmicRadio') Logarithmic
                    p.small.pt-2.pr-2.mb-0.text-right
                        em Data derived from&nbsp;
                            a.w-100.pt-2(href="https://api.covid19india.org" target="_blank") COVID19-India API
                                i.icon-new-tab.ml-1

            .col-sm-12
                .card.pb-2.mb-4
                    .card-header.bg-dark
                        h3.text-white.mb-0 Cases by States and Districts
                    .card-body.pb-2
                        p#icmrReport
                        include includes/datatables/datatable-country.pug
                        #loader.text-center
                            i.icon-spinner.spinner-animate
                    p.small.pt-2.pr-2.mb-0.text-right
                        em Data derived from&nbsp;
                            a.w-100.pt-2(href="https://api.covid19india.org" target="_blank") COVID19-India API
                                i.icon-new-tab.ml-1
            .col-sm-12
                .card.mb-4
                    .card-header.bg-dark
                        h5.text-white Top COVID-19 related News
                    .card-body.px-md-5(style="position:relative;")
                        #news-results-number.p-3.text-gray-600.small
                        .row.news-deck-outer
                            .news-deck-inner#card-deck.card-deck.mt-2.mb-0(style="flex-flow: initial;")
                                div.card.h-100.lift.mx-md-3.mx-2
                                    div.card-img-top.img-fluid(style='background:#F5F5F5;height:150px')
                                        i.icon-spinner.spinner-animate.align-self-center
                                    .card-body
                                        h5.card-title.mb-2
                                            i.icon-spinner.spinner-animate
                        div.deck-control-left.arrow.d-sm-none.d-md-flex
                            span.icon-circle-left
                        div.deck-control-right.arrow.d-sm-none.d-md-flex
                            span.icon-circle-right
                    p.small.pt-2.pr-2.mb-1.text-right
                        em Data derived from&nbsp;
                            a.w-100.pt-2(href="https://smartable.ai/" target="_blank") Smartable AI
                                i.icon-new-tab.ml-1
        .row
            .col-sm-12
                .card.pb-2.mb-4
                    .card-body
                        .d-flex.flex-column.bd-highlight.mb-0
                            h2.pb-2.mb-2.border-bottom Quick Links
                            ul
                                li.py-1.bd-highlight
                                    a(href="/in-resources") India Resoucres
                                li.py-1.bd-highlight
                                    a(href="/us") Global Dashboard
                                li.py-1.bd-highlight
                                    a(href="/us") USA Dashboard
                                li.py-1.bd-highlight
                                    a(href="/about") About COVID-19 & This Project
        //- Extra large modal
        .modal.fade#stateModal(tabindex='-1', role='dialog', aria-labelledby='stateModal', aria-hidden='true')
            .modal-dialog.modal-xl(role='document')
                .modal-content
                    .modal-header.bg-dark
                        h3.display-5.modal-title.text-white-75#stateName
                        button.close(type='button', data-dismiss='modal', aria-label='Close')
                            span.text-white-75.icon-cross(aria-hidden='true')
                    .modal-body
                        .datatable.table-responsive.pb-3#subDataTable
                            table#dataTableState.table.table-bordered.table-hover(width='100%', cellspacing='0')
                    .modal-footer
                        button.btn.btn-primary(type='button', data-dismiss='modal') Close
append scripts
    script(src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js', crossorigin='anonymous')
    script(src='https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js', crossorigin='anonymous')
    script(src='https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js', crossorigin='anonymous')
    script(src='js/in.min.js')
    //- script(src='js/utilities.js')
    //- script(src='js/in.js')
    //- script(src='js/scripts.js')